(function(){"use strict";let l,p,v,h;onmessage=function(t){t.data.canvas&&(l=t.data.canvas,d()),t.data.opts&&(p=t.data.opts,d()),t.data.events&&(v=t.data.events,d()),t.data.event_types&&(h=t.data.event_types,d())};function x(t,e){let s=!1;return()=>{s||(s=!0,setTimeout(()=>{s=!1,t()},e))}}let y=0;async function b(){if(!l||!p||!v||!h)return;const{margins:t,canvasWidth:e,canvasHeight:s,visibleStartTimeSec:r,visibleEndTimeSec:u}=p;l.width=e,l.height=s;const n=l.getContext("2d");if(!n)return;n.clearRect(0,0,e,s),y+=1;const $=y,D=v.filter(i=>i.s<=u&&i.e>=r);let g=Date.now();const w=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255],[255,128,0],[255,0,128],[128,255,0],[0,255,128],[128,0,255],[0,128,255]],m={};for(const i of h){const o=w[i.color_index%w.length];m[i.event_type]=o}for(const i of["rect","line"])for(const o of D){if($!==y)return;const c=m[o.t];if(o.e>o.s){if(i!=="rect")continue;const a={x:t.left+(o.s-r)/(u-r)*(e-t.left-t.right),y:t.top,w:(o.e-o.s)/(u-r)*(e-t.left-t.right),h:s-t.top-t.bottom};n.fillStyle=`rgba(${c[0]},${c[1]},${c[2]},0.3)`,n.fillRect(a.x,a.y,a.w,a.h);const f=Date.now()-g;f>100&&(await T(f),g=Date.now())}else{if(i!=="line")continue;const a={x:t.left+(o.s-r)/(u-r)*(e-t.left-t.right),y:t.top},f={x:a.x,y:s-t.bottom};n.strokeStyle=`rgba(${c[0]},${c[1]},${c[2]},1)`,n.beginPath(),n.moveTo(a.x,a.y),n.lineTo(f.x,f.y),n.stroke()}}}const d=x(b,10);function T(t){return new Promise(e=>{setTimeout(e,t)})}})();
