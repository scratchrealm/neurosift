(function(){"use strict";let t,f,h;onmessage=function(e){e.data.canvas!==void 0&&(t=e.data.canvas,u()),e.data.opts!==void 0&&(f=e.data.opts,u()),e.data.plotData!==void 0&&(h=e.data.plotData,u())};function m(e,s){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{r=!1,e()},s))}}async function v(){if(!t||!f)return;const{margins:e,canvasWidth:s,canvasHeight:r,visibleStartTimeSec:l,visibleEndTimeSec:o,hoveredUnitId:g,selectedUnitIds:a,zoomInRequired:i}=f;t.width=s,t.height=r;const n=t.getContext("2d");if(!n)return;if(i){n.clearRect(0,0,s,r),n.fillStyle="pink",n.textAlign="center",n.textBaseline="middle",n.font="20px Arial",n.fillText("Zoom in (mouse-wheel) to view raster plot",s/2,r/2);return}if(!h)return;const T=h.plots.length,b=d=>r-e.bottom-(d+.5-0)/(T-0)*(r-e.top-e.bottom),c=d=>e.left+(d-l)/(o-l)*(s-e.left-e.right),k=h.plots.map((d,I)=>({y:b(I),x:d.spikeTimesSec.map(S=>c(S)),unitId:d.unitId,color:d.color,hovered:d.unitId===g,selected:a.includes(d.unitId)}));y(n,k)}const u=m(v,10),y=(e,s)=>{if(!f)return;const{margins:r,canvasWidth:l,canvasHeight:o}=f;e.clearRect(0,0,l,o);const g=o/s.length;for(const a of[1,2,3])s.forEach(i=>{(a===1&&g>=10||a===2&&i.selected||a===3&&i.hovered)&&(e.fillStyle=a===1?i.color:a===2?"black":i.color,e.textAlign="right",e.textBaseline="middle",e.font=`${a>1?"bold ":""}12px Arial`,e.fillText(i.unitId+"",r.left-4,i.y),(a===3||a===2&&i.hovered)&&(e.textAlign="left",e.textBaseline="middle",e.font=`${a>1?"bold ":""}12px Arial`,e.fillText(i.unitId+"",l-r.right+4,i.y)))});e.save(),e.beginPath(),e.rect(r.left,r.top,l-r.left-r.right,o-r.top-r.bottom),e.clip();for(const a of[1,2])s.forEach(i=>{a===2&&i.hovered&&(e.strokeStyle="yellow",e.lineWidth=3,e.beginPath(),e.moveTo(0,i.y),e.lineTo(l,i.y),e.stroke(),e.strokeStyle="gray",e.lineWidth=1,e.beginPath(),e.moveTo(0,i.y),e.lineTo(l,i.y),e.stroke()),a===1&&i.selected&&(e.strokeStyle="lightblue",e.lineWidth=3,e.beginPath(),e.moveTo(0,i.y),e.lineTo(l,i.y),e.stroke())});s.forEach(a=>{e.strokeStyle=a.color,e.lineWidth=3,e.beginPath(),a.x.forEach(i=>{e.moveTo(i-2,a.y),e.lineTo(i+2,a.y)}),e.stroke()}),e.restore()}})();
