(function(){"use strict";let p,m,d;const P=(e,c,i,g)=>{const b=c-e;if(!b)return[];const l=Math.floor(Math.log10(g*b/i)),r=[1,2,5].map(x=>x*Math.pow(10,l)),y=r.map(x=>Math.abs(x-g*b/i)),N=y.indexOf(Math.min(...y)),T=r[N],t=Math.ceil(e/T),h=Math.floor(c/T),k=[];for(let x=t;x<=h;x++){const f=x*T;k.push({value:f,major:!1})}return k};onmessage=function(e){e.data.canvas&&(p=e.data.canvas,M()),e.data.opts&&(m=e.data.opts,M()),e.data.dataSeries&&(d=e.data.dataSeries,M())};function w(e,c){let i=!1;return()=>{i||(i=!0,setTimeout(()=>{i=!1,e()},c))}}async function B(){if(!p||!m||!d)return;const{margins:e,canvasWidth:c,canvasHeight:i,visibleStartTimeSec:g,visibleEndTimeSec:b,xMin:l,xMax:u,yMin:r,yMax:y,xAxisLabel:N,yAxisLabel:T}=m;p.width=c,p.height=i;const t=p.getContext("2d");if(!t)return;t.clearRect(0,0,c,i);const h=Math.min((c-e.left-e.right)/(u-l),(i-e.top-e.bottom)/(y-r)),k=(c-e.left-e.right-(u-l)*h)/2,x=(i-e.top-e.bottom-(y-r)*h)/2,f=o=>({x:isNaN(o.x)?NaN:e.left+k+(o.x-l)*h,y:isNaN(o.y)?NaN:i-e.bottom-x-(o.y-r)*h}),A=o=>{const n=o.toFixed(10),a=n.indexOf(".");if(a<0)return n;let s=n.length-1;for(;s>a&&n[s]==="0";)s--;return n[s]==="."&&s--,n.slice(0,s+1)},C=P(l,u,c-e.left-e.right,180);(()=>{const o=f({x:l,y:r}),n=f({x:u,y:r});t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(n.x,n.y),t.strokeStyle="rgb(0,0,0)",t.stroke();for(const a of C){const s=f({x:a.value,y:r});t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(s.x,s.y+5),t.strokeStyle="rgb(0,0,0)",t.stroke(),t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="center",t.textBaseline="top",t.fillText(A(a.value),s.x,s.y+7)}t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="center",t.textBaseline="top",t.fillText(N,(o.x+n.x)/2,o.y+18)})();const z=P(r,y,i-e.top-e.bottom,80);(()=>{const o=f({x:l,y:r}),n=f({x:l,y});t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(n.x,n.y),t.strokeStyle="rgb(0,0,0)",t.stroke();for(const a of z){const s=f({x:l,y:a.value});t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(s.x-5,s.y),t.strokeStyle="rgb(0,0,0)",t.stroke(),t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="right",t.textBaseline="middle",t.fillText(A(a.value),s.x-7,s.y)}t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="center",t.textBaseline="top",t.save(),t.translate(o.x-45,(o.y+n.y)/2),t.rotate(-Math.PI/2),t.fillText(T,0,0),t.restore()})();const L=o=>{const n=(o-g)/(b-g),a=0,s=Math.floor(255*(1-n)),v=Math.floor(255*n);return`rgb(${a},${s},${v})`};let S;for(let o=0;o<d.t.length;o++){const n=d.t[o];if(n<g||n>b)continue;const a=d.x[o],s=d.y[o];if(isNaN(a)||isNaN(s))S=void 0;else{const v=f({x:d.x[o],y:d.y[o]});S&&(t.beginPath(),t.moveTo(S.x,S.y),t.lineTo(v.x,v.y),t.strokeStyle=L(n),t.stroke()),S=v}}}const M=w(B,10)})();
